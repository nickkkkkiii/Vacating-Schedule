const { Telegraf } = require('telegraf');

// === Конфигурация ===
const BOT_TOKEN = process.env.TELEGRAM_BOT_TOKEN;
const CHAT_ID = process.env.TELEGRAM_CHAT_ID;
const TARGET_DATE_STR = "2025-10-11";

// Инициализируем бота
const bot = new Telegraf(BOT_TOKEN);

module.exports = async (req, res) => {
  try {
    const targetDate = new Date(TARGET_DATE_STR);
    const today = new Date();
    const diffTime = targetDate - today;
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

let message;

if (diffDays > 90) {
  message = `🗓️ До поездки в Турцию осталось больше 90 дней!\n\nСамое время начать планировать маршрут и бронировать отель 🏨🧳`;
} else if (diffDays === 90) {
  message = `🧭 Турция всё ближе! Осталось 90 дней.\n\nПора открывать карту и строить маршруты 🗺️✈️`;
} else if (diffDays === 89) {
  message = `✈️ Осталось 89 дней до Турции!\n\nЗабудь про спонтанность — всё должно быть идеально продумано 🌟🌴`;
} else if (diffDays === 88) {
  message = `🥦 Осталось 88 дней. Пора убрать фаст-фуд из рациона.\n\nТурция ждёт тебя в отличной форме 🍽️💪`;
} else if (diffDays === 87) {
  message = `👕 Осталось 87 дней. Что наденешь на пляж? Начни собирать гардероб уже сейчас 🌞🛍️`;
} else if (diffDays === 86) {
  message = `🧳 Осталось 86 дней. Первые чемоданы можно уже распаковать…\n\nНет, подожди ещё чуть-чуть! 😉`;
} else if (diffDays === 85) {
  message = `📸 Осталось 85 дней. Подготовь фотоальбом для будущих воспоминаний 📷🌴`;
} else if (diffDays === 84) {
  message = `🗺️ Осталось 84 дня. Выбирай, куда поедешь:\n\nАнталия, Бодрум или Алания? 🌊`;
} else if (diffDays === 83) {
  message = `🌴 Осталось 83 дня. Почувствуй запах моря уже сегодня — открой окно и представь себя там 🌬️🌊`;
} else if (diffDays === 82) {
  message = `🌞 Осталось 82 дня. Проверь свой загар — пора начать готовиться к солнцу 🌞🕶️`;
} else if (diffDays === 81) {
  message = `🍽️ Осталось 81 день. Посмотри пару видео о местных блюдах — уже хочется попробовать всё! 🥘🇹🇷`;
} else if (diffDays === 80) {
  message = `🚫 Фаст-фуд, ты мне не нужен!\n\nДо поездки в Турцию осталось ${diffDays} дней. Пора начать заботиться о фигуре 👟🥗`;
} else if (diffDays === 79) {
  message = `🏋️‍♂️ Осталось 79 дней до Турции!\n\nВремя качать пресс — скоро купальник на виду 😎`;
} else if (diffDays === 78) {
  message = `🏖️ Осталось 78 дней. Проверь прогноз погоды — уже тепло! 🌡️☀️`;
} else if (diffDays === 77) {
  message = `🧼 Осталось 77 дней. Пора чистить солнцезащитные очки — они тебе скоро понадобятся 🕶️🌴`;
} else if (diffDays === 76) {
  message = `Осталось 76 дней. Убедись, что загранпаспорт действителен — он твой пропуск в рай 🛂🌴`;
} else if (diffDays === 75) {
  message = `🎒 Осталось 75 дней. Время выбрать сумку для путешествий — удобство прежде всего 🧳✈️`;
} else if (diffDays === 74) {
  message = `📱 Осталось 74 дня. Подпишись на туры и блогеров из Турции — получишь кучу идей 📲🌍`;
} else if (diffDays === 73) {
  message = `🛏️ Осталось 73 дня. Пора определиться с жильём — отель, апартаменты или вилла? 🏡`;
} else if (diffDays === 72) {
  message = `💸 Осталось 72 дня. Сколько ушло на билеты? Запиши, чтобы не забыть 💵`;
} else if (diffDays === 71) {
  message = `📖 Осталось 71 день. Посмотри пару видео о достопримечательностях — вдохновляйся 🏛️🎥`;
} else if (diffDays === 70) {
  message = `🌴 Осталось 70 дней. Сегодня начни следить за ценами на авиабилеты — может быть акция! 📉✈️`;
} else if (diffDays === 69) {
  message = `🌤️ Осталось 69 дней. Проверь погоду в регионе отдыха — будет ли солнечно? ☀️`;
} else if (diffDays === 68) {
  message = `🛎️ Осталось 68 дней. Забронируй экскурсии заранее — так дешевле 🏞️🎫`;
} else if (diffDays === 67) {
  message = `💡 Осталось 67 дней. Идеальный момент для списков: "Что взять", "Куда съездить" и т.д. 📋`;
} else if (diffDays === 66) {
  message = `🧘‍♀️ Осталось 66 дней. Расслабься! Ты на пути к лучшему отдыху 🧘‍♂️🌿`;
} else if (diffDays === 65) {
  message = `💼 Осталось 65 дней. Пора напомнить коллегам, что ты уезжаешь — отдых не ждёт! 🚫💻`;
} else if (diffDays === 64) {
  message = `Осталось 64 дня. Откладывай по 1% в копилку "на вкусности" 🍸`;
} else if (diffDays === 63) {
  message = `📸 Осталось 63 дня. Подготовь камеру — места будут невероятными 📷✨`;
} else if (diffDays === 62) {
  message = `🧭 Осталось 62 дня. Пора выбрать, где будешь завтракать — на берегу или у бассейна? 🥣🌅`;
} else if (diffDays === 61) {
  message = `📅 Осталось 61 день. Пора вывесить календарь с обратным отсчётом дома 🖼️⏳`;
} else if (diffDays === 60) {
  message = `📆 Осталось 60 дней. Прошёл первый этап подготовки — самое время отдохнуть 🍹`;
} else if (diffDays === 59) {
  message = `🛌 Осталось 59 дней. Пора проверить отзывы о твоём отеле — всё ли соответствует ожиданиям? 📝`;
} else if (diffDays === 58) {
  message = `🍴 Осталось 58 дней. Сегодня выбери ресторан своей мечты в Турции 🍴🍷`;
} else if (diffDays === 57) {
  message = `🧖‍♀️ Осталось 57 дней. Пора записаться на массаж перед отпуском — расслабься заранее 🧖‍♂️`;
} else if (diffDays === 56) {
  message = `🧴 Осталось 56 дней. Не забудь купить солнцезащитный крем — лучше сделать это дома 🧴`;
} else if (diffDays === 55) {
  message = `🎧 Осталось 55 дней. Создай плейлист для поездки — пусть музыкально настроит себя 🎶`;
} else if (diffDays === 54) {
  message = `📘 Осталось 54 дня. Загрузи книгу или подкаст для дороги — время полетит незаметно 📖✈️`;
} else if (diffDays === 53) {
  message = `👣 Осталось 53 дня. Сегодня сделай первый шаг к образу жизни «турецкого» 🏖️`;
} else if (diffDays === 52) {
  message = `🧼 Осталось 52 дня. Пора начать утренние пробежки — лето близко 🏃‍♂️`;
} else if (diffDays === 51) {
  message = `📈 Осталось 51 день. Какие цели у тебя в этом отпуске? Запиши их 🎯`;
} else if (diffDays === 50) {
  message = `🎉 Осталось 50 дней. Полпути пройдено! Это повод обрадоваться 🎈`;
} else if (diffDays === 49) {
  message = `🌊 Осталось 49 дней. Представь, как ты входишь в тёплое море — ощущение уже рядом 🧊➡️🔥`;
} else if (diffDays === 48) {
  message = `🕶️ Осталось 48 дней. Проверь свои очки — без них в Турции будет сложно 🌞`;
} else if (diffDays === 47) {
  message = `🏝️ Осталось 47 дней. Сегодня подумай о том, куда съездить в первую очередь 🏝️`;
} else if (diffDays === 46) {
  message = `🗺️ Осталось 46 дней. Пора наметить план на первые три дня отдыха 🗺️📍`;
} else if (diffDays === 45) {
  message = `🧳 Осталось 45 дней. Пора составить список вещей, которые точно нужны 🧦🧼🧼`;
} else if (diffDays === 44) {
  message = `📷 Осталось 44 дня. Проверь свою камеру — батарея заряжена? 🔋📸`;
} else if (diffDays === 43) {
  message = `👗 Осталось 43 дня. Выбирай свой главный наряд для отпуска — будь модным на пляже 👚`;
} else if (diffDays === 42) {
  message = `🪥 Осталось 42 дня. Сегодня начни собирать дорожную аптечку — на всякий случай 💊`;
} else if (diffDays === 41) {
  message = `📞 Осталось 41 день. Сообщи друзьям точную дату поездки — пусть тоже завидуют 😎`;
} else if (diffDays === 40) {
  message = `⏰ Осталось 40 дней. Пора начать считать часы вместо дней 🕒`;
} else if (diffDays === 39) {
  message = `👀 Осталось 39 дней. Сегодня открой сайт туроператора и просто посмотри на цены 📊`;
} else if (diffDays === 38) {
  message = `🌴 Осталось 38 дней. Пора освободить голову от лишних мыслей — отдых уже близко 🧠`;
} else if (diffDays === 37) {
  message = `🍹 Осталось 37 дней. Сегодня вечером — коктейль в честь предстоящего отпуска 🍹`;
} else if (diffDays === 36) {
  message = `🛌 Осталось 36 дней. Пора перейти на режим "спать рано" — силы понадобятся 💤`;
} else if (diffDays === 35) {
  message = `🧾 Осталось 35 дней. Пора оформить страховку — лучше перестраховаться 🏥`;
} else if (diffDays === 34) {
  message = `🧳 Осталось 34 дня. Пора упаковать что-нибудь из одежды — пусть чемодан ждёт тебя 🧳`;
} else if (diffDays === 33) {
  message = `📱 Осталось 33 дня. Пора скачать карты офлайн — без интернета не останешься 🌐`;
} else if (diffDays === 32) {
  message = `🌞 Осталось 32 дня. Сегодня выходи на солнце — пусть кожа привыкает к лучам ☀️`;
} else if (diffDays === 31) {
  message = `🪑 Осталось 31 день. Пора найти себе замену на работе — ты почти свободен 🧊`;
} else if (diffDays === 30) {
  message = `🧺 Осталось 30 дней. Скоро сборы! Самое время проверить, что ты возьмёшь 🧷`;
} else if (diffDays === 29) {
  message = `👟 Осталось 29 дней. Пора обуться потеплее — нет, это шутка. Ты же в отпуск собираешься 😄`;
} else if (diffDays === 28) {
  message = `Осталось 28 дней. Пора начать ложиться пораньше — отпуск требует энергии ⏰`;
} else if (diffDays === 27) {
  message = `🌴 Осталось 27 дней. Сегодня начни учить базовые фразы на турецком 🇹🇷`;
} else if (diffDays === 26) {
  message = `📦 Осталось 26 дней. Пора проверить, всё ли влезет в чемодан 🧳`;
} else if (diffDays === 25) {
  message = `🪔 Осталось 25 дней. Пора напомнить себе, зачем ты едешь — ради чего? 🌴`;
} else if (diffDays === 24) {
  message = `📸 Осталось 24 дня. Сегодня начни делать фото-подборку для Instagram 📱`;
} else if (diffDays === 23) {
  message = `💬 Осталось 23 дня. Обсуди с друзьями, кто что привезёт из Турции 🎁`;
} else if (diffDays === 22) {
  message = `🛌 Осталось 22 дня. Сегодня — день отдохнуть от подготовки 😌`;
} else if (diffDays === 21) {
  message = `🎯 Осталось 21 день. Пора определиться с главной целью отпуска — впечатления или релакс 🧘‍♀️`;
} else if (diffDays === 20) {
  message = `🪑 Осталось 20 дней. Пора закончить все дела — ты почти свободен 🚀`;
} else if (diffDays === 19) {
  message = `🌞 Осталось 19 дней. Сегодня проверь уровень своего загара — ещё можно нагнать ☀️`;
} else if (diffDays === 18) {
  message = `🌴 Осталось 18 дней. Ты уже чувствуешь запах моря? 🌊`;
} else if (diffDays === 17) {
  message = `🌙 Осталось 17 дней. Пора начать ложиться пораньше — отпуск не простит недосып 🌙`;
} else if (diffDays === 16) {
  message = `🛒 Осталось 16 дней. Сегодня отправляйся за подарками для друзей 🎁`;
} else if (diffDays === 15) {
  message = `🎁 Осталось 15 дней. Пора выбрать, кому что привезти из Турции 🎁🇹🇷`;
} else if (diffDays === 14) {
  message = `📆 Осталось 14 дней. Пора вывесить календарь с обратным отсчётом на холодильник 📅`;
} else if (diffDays === 13) {
  message = `🧳 Осталось 13 дней. Чемодан уже собран? Проверь, что не забыл 🧦🧷`;
} else if (diffDays === 12) {
  message = `🌴 Осталось 12 дней. Пора начать представлять себя на пляже 🌅`;
} else if (diffDays === 11) {
  message = `☕ Осталось 11 дней. Сегодня последний кофе в офисе — потом только на пляже ☕`;
} else if (diffDays === 10) {
  message = `✨ До поездки в Турцию осталось ${diffDays} дней. Всем хорошего дня! 🌴`;
} else if (diffDays === 9) {
  message = `✨ До поездки в Турцию осталось ${diffDays} дней. Всем хорошего дня! 🌴`;
} else if (diffDays === 8) {
  message = `✨ До поездки в Турцию осталось ${diffDays} дней. Всем хорошего дня! 🌴`;
} else if (diffDays === 7) {
  message = `✨ До поездки в Турцию осталось ${diffDays} дней. Всем хорошего дня! 🌴`;
} else if (diffDays === 6) {
  message = `✨ До поездки в Турцию осталось ${diffDays} дней. Всем хорошего дня! 🌴`;
} else if (diffDays === 5) {
  message = `✨ До поездки в Турцию осталось ${diffDays} дней. Всем хорошего дня! 🌴`;
} else if (diffDays === 4) {
  message = `✨ До поездки в Турцию осталось ${diffDays} дней. Всем хорошего дня! 🌴`;
} else if (diffDays === 3) {
  message = `✨ До поездки в Турцию осталось ${diffDays} дней. Всем хорошего дня! 🌴`;
} else if (diffDays === 2) {
  message = `✨ До поездки в Турцию осталось ${diffDays} дней. Всем хорошего дня! 🌴`;
} else if (diffDays === 1) {
  message = `✨ До поездки в Турцию остался ${diffDays} день. Всем хорошего дня! 🌴`;
} else if (diffDays === 0) {
  message = `🎉 Поездка в Турцию начинается сегодня! Пора собираться 🌴✈️`;
} else {
  message = `🌴☀️ Поездка в Турцию уже началась! Пора отдыхать 🌴✈️`;
}

    // Формируем URL картинки по diffDays
    const imageUrl = `https://schedular-vacating.vercel.app/images/${diffDays}.jpg`;

    // Отправляем фото с подписью
    await bot.telegram.sendPhoto(CHAT_ID, imageUrl, { caption: message });

    return res.status(200).send("Сообщение отправлено с картинкой");
  } catch (error) {
    console.error("Ошибка:", error.message);
    return res.status(500).send("Ошибка при отправке сообщения");
  }
};